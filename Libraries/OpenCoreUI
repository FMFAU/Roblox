local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")

local Mouse = Players.LocalPlayer:GetMouse()

-- Try CoreGui first, fallback to PlayerGui
local function GetGuiParent()
	local success, result = pcall(function()
		return game:GetService("CoreGui")
	end)

	if success and result then
		local test = Instance.new("Folder")
		local canUse = pcall(function()
			test.Parent = result
			test:Destroy()
		end)

		if canUse then
			return result
		end
	end

	return Players.LocalPlayer:WaitForChild("PlayerGui")
end

-- Lucide Icons
local Icons = {
	Close = "rbxassetid://11293981586",
	Minimize = "rbxassetid://11293980042",
	ChevronDown = "rbxassetid://12974428978",
}

-- OpenCore Library
local OpenCore = {
	Flags = {},
	CurrentTheme = "Dark",
	Themes = {
		Dark = {
			Primary = Color3.fromRGB(255, 255, 255),
			Secondary = Color3.fromRGB(200, 200, 200),
			Accent = Color3.fromRGB(180, 180, 180),

			Background = Color3.fromRGB(15, 15, 15),
			Surface = Color3.fromRGB(20, 20, 20),
			Card = Color3.fromRGB(25, 25, 25),

			Text = Color3.fromRGB(255, 255, 255),
			SubText = Color3.fromRGB(160, 160, 160),
			Muted = Color3.fromRGB(100, 100, 100),

			Success = Color3.fromRGB(120, 120, 120), -- Grayscale

			Border = Color3.fromRGB(40, 40, 40),
			Hover = Color3.fromRGB(35, 35, 35),
			SliderFill = Color3.fromRGB(255, 255, 255)
		},
		Light = {
			Primary = Color3.fromRGB(30, 30, 30),
			Secondary = Color3.fromRGB(60, 60, 60),
			Accent = Color3.fromRGB(80, 80, 80),

			Background = Color3.fromRGB(245, 245, 245),
			Surface = Color3.fromRGB(255, 255, 255),
			Card = Color3.fromRGB(248, 248, 248),

			Text = Color3.fromRGB(20, 20, 20),
			SubText = Color3.fromRGB(100, 100, 100),
			Muted = Color3.fromRGB(150, 150, 150),

			Success = Color3.fromRGB(59, 130, 246), -- Blue

			Border = Color3.fromRGB(220, 220, 220),
			Hover = Color3.fromRGB(235, 235, 235),
			SliderFill = Color3.fromRGB(59, 130, 246)
		}
	}
}

local Theme = OpenCore.Themes[OpenCore.CurrentTheme]

-- Utility Functions
local function Tween(obj, props, duration)
	duration = duration or 0.2
	TweenService:Create(obj, TweenInfo.new(duration, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), props):Play()
end

local function MakeDraggable(frame, handle)
	local dragging = false
	local dragInput, dragStart, startPos

	handle.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			dragging = true
			dragStart = input.Position
			startPos = frame.Position

			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then
					dragging = false
				end
			end)
		end
	end)

	handle.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement then
			dragInput = input
		end
	end)

	UserInputService.InputChanged:Connect(function(input)
		if input == dragInput and dragging then
			local delta = input.Position - dragStart
			frame.Position = UDim2.new(
				startPos.X.Scale,
				startPos.X.Offset + delta.X,
				startPos.Y.Scale,
				startPos.Y.Offset + delta.Y
			)
		end
	end)
end

local function AddCorner(parent, radius)
	local corner = Instance.new("UICorner")
	corner.CornerRadius = UDim.new(0, radius or 4)
	corner.Parent = parent
	return corner
end

local function AddStroke(parent, color, thickness, transparency)
	local stroke = Instance.new("UIStroke")
	stroke.Color = color or Theme.Border
	stroke.Thickness = thickness or 1
	stroke.Transparency = transparency or 0
	stroke.Parent = parent
	return stroke
end

-- Create Window
function OpenCore:CreateWindow(config)
	config = config or {}
	config.Title = config.Title or "OpenCore"
	config.Subtitle = config.Subtitle or "Modern UI Library"
	config.Size = config.Size or UDim2.new(0, 700, 0, 550)
	config.Theme = config.Theme or "Dark"

	-- Set theme
	OpenCore.CurrentTheme = config.Theme
	Theme = OpenCore.Themes[OpenCore.CurrentTheme]

	local GuiParent = GetGuiParent()

	-- Cleanup
	if GuiParent:FindFirstChild("OpenCore") then
		GuiParent:FindFirstChild("OpenCore"):Destroy()
	end

	local Window = {
		Tabs = {},
		CurrentTab = nil,
		Theme = Theme
	}

	-- ScreenGui
	local gui = Instance.new("ScreenGui")
	gui.Name = "OpenCore"
	gui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
	gui.Parent = GuiParent

	-- Main Container
	local main = Instance.new("Frame")
	main.Name = "Main"
	main.AnchorPoint = Vector2.new(0.5, 0)
	main.BackgroundColor3 = Theme.Background
	main.BorderSizePixel = 0
	main.Position = UDim2.new(0.5, 0, 0.5, -config.Size.Y.Offset/2)
	main.Size = config.Size
	main.ClipsDescendants = true
	main.Parent = gui

	AddCorner(main, 6)
	AddStroke(main, Theme.Border, 1, 0)

	-- Top Bar
	local topBar = Instance.new("Frame")
	topBar.Name = "TopBar"
	topBar.BackgroundColor3 = Theme.Surface
	topBar.BorderSizePixel = 0
	topBar.Size = UDim2.new(1, 0, 0, 50)
	topBar.Parent = main

	AddCorner(topBar, 6)

	local topBarFix = Instance.new("Frame")
	topBarFix.BackgroundColor3 = Theme.Surface
	topBarFix.BorderSizePixel = 0
	topBarFix.Position = UDim2.new(0, 0, 1, -6)
	topBarFix.Size = UDim2.new(1, 0, 0, 6)
	topBarFix.Parent = topBar

	-- Bottom border line
	local bottomLine = Instance.new("Frame")
	bottomLine.BackgroundColor3 = Theme.Border
	bottomLine.BorderSizePixel = 0
	bottomLine.Position = UDim2.new(0, 0, 1, -1)
	bottomLine.Size = UDim2.new(1, 0, 0, 1)
	bottomLine.Parent = topBar

	-- Title
	local title = Instance.new("TextLabel")
	title.BackgroundTransparency = 1
	title.Font = Enum.Font.GothamBold
	title.Text = config.Title
	title.TextColor3 = Theme.Text
	title.TextSize = 16
	title.Position = UDim2.new(0, 15, 0, 8)
	title.Size = UDim2.new(0, 300, 0, 20)
	title.TextXAlignment = Enum.TextXAlignment.Left
	title.Parent = topBar

	-- Subtitle
	local subtitle = Instance.new("TextLabel")
	subtitle.BackgroundTransparency = 1
	subtitle.Font = Enum.Font.Gotham
	subtitle.Text = config.Subtitle
	subtitle.TextColor3 = Theme.SubText
	subtitle.TextSize = 12
	subtitle.Position = UDim2.new(0, 15, 0, 28)
	subtitle.Size = UDim2.new(0, 300, 0, 18)
	subtitle.TextXAlignment = Enum.TextXAlignment.Left
	subtitle.Parent = topBar

	-- Close button (instant close, no animation)
	local closeBtn = Instance.new("TextButton")
	closeBtn.AnchorPoint = Vector2.new(1, 0.5)
	closeBtn.BackgroundColor3 = Theme.Card
	closeBtn.BorderSizePixel = 0
	closeBtn.Position = UDim2.new(1, -10, 0.5, 0)
	closeBtn.Size = UDim2.new(0, 30, 0, 30)
	closeBtn.Text = ""
	closeBtn.Parent = topBar

	AddCorner(closeBtn, 4)

	local closeIcon = Instance.new("ImageLabel")
	closeIcon.AnchorPoint = Vector2.new(0.5, 0.5)
	closeIcon.BackgroundTransparency = 1
	closeIcon.Position = UDim2.new(0.5, 0, 0.5, 0)
	closeIcon.Size = UDim2.new(0, 16, 0, 16)
	closeIcon.Image = Icons.Close
	closeIcon.ImageColor3 = Theme.SubText
	closeIcon.Parent = closeBtn

	closeBtn.MouseEnter:Connect(function()
		Tween(closeBtn, {BackgroundColor3 = Color3.fromRGB(239, 68, 68)}, 0.2)
		Tween(closeIcon, {ImageColor3 = Color3.fromRGB(255, 255, 255)}, 0.2)
	end)

	closeBtn.MouseLeave:Connect(function()
		Tween(closeBtn, {BackgroundColor3 = Theme.Card}, 0.2)
		Tween(closeIcon, {ImageColor3 = Theme.SubText}, 0.2)
	end)

	closeBtn.MouseButton1Click:Connect(function()
		gui:Destroy()
	end)

	-- Minimize button
	local minimizeBtn = Instance.new("TextButton")
	minimizeBtn.AnchorPoint = Vector2.new(1, 0.5)
	minimizeBtn.BackgroundColor3 = Theme.Card
	minimizeBtn.BorderSizePixel = 0
	minimizeBtn.Position = UDim2.new(1, -45, 0.5, 0)
	minimizeBtn.Size = UDim2.new(0, 30, 0, 30)
	minimizeBtn.Text = ""
	minimizeBtn.Parent = topBar

	AddCorner(minimizeBtn, 4)

	local minimizeIcon = Instance.new("ImageLabel")
	minimizeIcon.AnchorPoint = Vector2.new(0.5, 0.5)
	minimizeIcon.BackgroundTransparency = 1
	minimizeIcon.Position = UDim2.new(0.5, 0, 0.5, 0)
	minimizeIcon.Size = UDim2.new(0, 16, 0, 16)
	minimizeIcon.Image = Icons.Minimize
	minimizeIcon.ImageColor3 = Theme.SubText
	minimizeIcon.Parent = minimizeBtn

	local minimized = false
	minimizeBtn.MouseEnter:Connect(function()
		Tween(minimizeBtn, {BackgroundColor3 = Theme.Hover}, 0.2)
		Tween(minimizeIcon, {ImageColor3 = Theme.Text}, 0.2)
	end)

	minimizeBtn.MouseLeave:Connect(function()
		Tween(minimizeBtn, {BackgroundColor3 = Theme.Card}, 0.2)
		Tween(minimizeIcon, {ImageColor3 = Theme.SubText}, 0.2)
	end)

	-- Sidebar (LEFT SIDE)
	local sidebar = Instance.new("ScrollingFrame")
	sidebar.Name = "Sidebar"
	sidebar.BackgroundColor3 = Theme.Surface
	sidebar.BorderSizePixel = 0
	sidebar.Position = UDim2.new(0, 0, 0, 50)
	sidebar.Size = UDim2.new(0, 170, 1, -50)
	sidebar.ScrollBarThickness = 4
	sidebar.ScrollBarImageColor3 = Theme.SubText
	sidebar.CanvasSize = UDim2.new(0, 0, 0, 0)
	sidebar.AutomaticCanvasSize = Enum.AutomaticSize.Y
	sidebar.Parent = main

	local sidebarList = Instance.new("UIListLayout")
	sidebarList.SortOrder = Enum.SortOrder.LayoutOrder
	sidebarList.Padding = UDim.new(0, 6)
	sidebarList.Parent = sidebar

	local sidebarPadding = Instance.new("UIPadding")
	sidebarPadding.PaddingTop = UDim.new(0, 10)
	sidebarPadding.PaddingLeft = UDim.new(0, 10)
	sidebarPadding.PaddingRight = UDim.new(0, 10)
	sidebarPadding.PaddingBottom = UDim.new(0, 10)
	sidebarPadding.Parent = sidebar

	-- Content area
	local content = Instance.new("Frame")
	content.Name = "Content"
	content.BackgroundTransparency = 1
	content.BorderSizePixel = 0
	content.Position = UDim2.new(0, 170, 0, 50)
	content.Size = UDim2.new(1, -170, 1, -50)
	content.Parent = main

	minimizeBtn.MouseButton1Click:Connect(function()
		minimized = not minimized

		if minimized then
			local originalPos = main.Position
			main.AnchorPoint = Vector2.new(0.5, 0)
			main.Position = originalPos
			Tween(main, {Size = UDim2.new(config.Size.X.Scale, config.Size.X.Offset, 0, 50)}, 0.3)
			wait(0.15)
			sidebar.Visible = false
			content.Visible = false
		else
			sidebar.Visible = true
			content.Visible = true
			Tween(main, {Size = config.Size}, 0.3)
		end
	end)

	MakeDraggable(main, topBar)

	-- Create Tab
	function Window:CreateTab(tabConfig)
		tabConfig = tabConfig or {}
		tabConfig.Name = tabConfig.Name or "Tab"
		tabConfig.Icon = tabConfig.Icon or "ðŸ“„"

		local Tab = {
			Sections = {}
		}

		-- Tab button
		local tabBtn = Instance.new("TextButton")
		tabBtn.Name = tabConfig.Name
		tabBtn.BackgroundColor3 = Theme.Card
		tabBtn.BorderSizePixel = 0
		tabBtn.Size = UDim2.new(1, 0, 0, 38)
		tabBtn.Text = ""
		tabBtn.Parent = sidebar

		AddCorner(tabBtn, 4)

		-- Tab icon
		local iconFrame = Instance.new("Frame")
		iconFrame.BackgroundTransparency = 1
		iconFrame.Position = UDim2.new(0, 10, 0.5, 0)
		iconFrame.AnchorPoint = Vector2.new(0, 0.5)
		iconFrame.Size = UDim2.new(0, 18, 0, 18)
		iconFrame.Parent = tabBtn

		local icon
		if tonumber(tabConfig.Icon) then
			icon = Instance.new("ImageLabel")
			icon.Image = "rbxassetid://" .. tabConfig.Icon
			icon.ImageColor3 = Theme.SubText
		else
			icon = Instance.new("TextLabel")
			icon.Text = tabConfig.Icon
			icon.TextColor3 = Theme.SubText
			icon.Font = Enum.Font.GothamBold
			icon.TextSize = 14
		end

		icon.BackgroundTransparency = 1
		icon.Size = UDim2.new(1, 0, 1, 0)
		icon.Parent = iconFrame

		-- Tab label
		local tabLabel = Instance.new("TextLabel")
		tabLabel.BackgroundTransparency = 1
		tabLabel.Font = Enum.Font.GothamMedium
		tabLabel.Text = tabConfig.Name
		tabLabel.TextColor3 = Theme.SubText
		tabLabel.TextSize = 13
		tabLabel.Position = UDim2.new(0, 35, 0, 0)
		tabLabel.Size = UDim2.new(1, -35, 1, 0)
		tabLabel.TextXAlignment = Enum.TextXAlignment.Left
		tabLabel.Parent = tabBtn

		-- Left indicator
		local indicator = Instance.new("Frame")
		indicator.BackgroundColor3 = Theme.Success
		indicator.BorderSizePixel = 0
		indicator.Size = UDim2.new(0, 2, 0, 0)
		indicator.Position = UDim2.new(0, 0, 0.5, 0)
		indicator.AnchorPoint = Vector2.new(0, 0.5)
		indicator.Parent = tabBtn

		-- Tab content
		local tabContent = Instance.new("ScrollingFrame")
		tabContent.Name = tabConfig.Name .. "Content"
		tabContent.BackgroundTransparency = 1
		tabContent.BorderSizePixel = 0
		tabContent.Size = UDim2.new(1, 0, 1, 0)
		tabContent.ScrollBarThickness = 4
		tabContent.ScrollBarImageColor3 = Theme.SubText
		tabContent.CanvasSize = UDim2.new(0, 0, 0, 0)
		tabContent.AutomaticCanvasSize = Enum.AutomaticSize.Y
		tabContent.Visible = false
		tabContent.Parent = content

		local contentList = Instance.new("UIListLayout")
		contentList.SortOrder = Enum.SortOrder.LayoutOrder
		contentList.Padding = UDim.new(0, 12)
		contentList.Parent = tabContent

		local contentPadding = Instance.new("UIPadding")
		contentPadding.PaddingTop = UDim.new(0, 15)
		contentPadding.PaddingLeft = UDim.new(0, 15)
		contentPadding.PaddingRight = UDim.new(0, 15)
		contentPadding.PaddingBottom = UDim.new(0, 15)
		contentPadding.Parent = tabContent

		Tab.Button = tabBtn
		Tab.Content = tabContent
		Tab.Icon = icon
		Tab.Label = tabLabel
		Tab.Indicator = indicator

		-- Tab selection
		tabBtn.MouseButton1Click:Connect(function()
			for _, tab in pairs(Window.Tabs) do
				tab.Content.Visible = false
				Tween(tab.Button, {BackgroundColor3 = Theme.Card}, 0.2)
				Tween(tab.Label, {TextColor3 = Theme.SubText}, 0.2)
				if tab.Icon.ClassName == "ImageLabel" then
					Tween(tab.Icon, {ImageColor3 = Theme.SubText}, 0.2)
				else
					Tween(tab.Icon, {TextColor3 = Theme.SubText}, 0.2)
				end
				Tween(tab.Indicator, {Size = UDim2.new(0, 2, 0, 0)}, 0.2)
			end

			tabContent.Visible = true
			Window.CurrentTab = Tab
			Tween(tabBtn, {BackgroundColor3 = Theme.Hover}, 0.2)
			Tween(tabLabel, {TextColor3 = Theme.Text}, 0.2)
			if icon.ClassName == "ImageLabel" then
				Tween(icon, {ImageColor3 = Theme.Text}, 0.2)
			else
				Tween(icon, {TextColor3 = Theme.Text}, 0.2)
			end
			Tween(indicator, {Size = UDim2.new(0, 2, 1, 0)}, 0.2)
		end)

		tabBtn.MouseEnter:Connect(function()
			if Window.CurrentTab ~= Tab then
				Tween(tabBtn, {BackgroundColor3 = Theme.Hover}, 0.15)
			end
		end)

		tabBtn.MouseLeave:Connect(function()
			if Window.CurrentTab ~= Tab then
				Tween(tabBtn, {BackgroundColor3 = Theme.Card}, 0.15)
			end
		end)

		table.insert(Window.Tabs, Tab)

		-- Auto-select first tab
		if #Window.Tabs == 1 then
			task.wait()
			tabContent.Visible = true
			Window.CurrentTab = Tab
			tabBtn.BackgroundColor3 = Theme.Hover
			tabLabel.TextColor3 = Theme.Text
			if icon.ClassName == "ImageLabel" then
				icon.ImageColor3 = Theme.Text
			else
				icon.TextColor3 = Theme.Text
			end
			indicator.Size = UDim2.new(0, 2, 1, 0)
		end

		-- Create Section
		function Tab:CreateSection(name)
			local Section = {}

			local section = Instance.new("Frame")
			section.Name = name
			section.BackgroundColor3 = Theme.Card
			section.BorderSizePixel = 0
			section.Size = UDim2.new(1, 0, 0, 0)
			section.AutomaticSize = Enum.AutomaticSize.Y
			section.Parent = tabContent

			AddCorner(section, 4)
			AddStroke(section, Theme.Border, 1, 0)

			-- Header
			local header = Instance.new("Frame")
			header.BackgroundTransparency = 1
			header.Size = UDim2.new(1, 0, 0, 40)
			header.Parent = section

			local sectionTitle = Instance.new("TextLabel")
			sectionTitle.BackgroundTransparency = 1
			sectionTitle.Font = Enum.Font.GothamBold
			sectionTitle.Text = name
			sectionTitle.TextColor3 = Theme.Text
			sectionTitle.TextSize = 14
			sectionTitle.Position = UDim2.new(0, 15, 0, 0)
			sectionTitle.Size = UDim2.new(1, -30, 1, 0)
			sectionTitle.TextXAlignment = Enum.TextXAlignment.Left
			sectionTitle.Parent = header

			-- Divider
			local divider = Instance.new("Frame")
			divider.BackgroundColor3 = Theme.Border
			divider.BorderSizePixel = 0
			divider.Position = UDim2.new(0, 15, 1, 0)
			divider.Size = UDim2.new(1, -30, 0, 1)
			divider.Parent = header

			-- Elements container
			local elements = Instance.new("Frame")
			elements.BackgroundTransparency = 1
			elements.Position = UDim2.new(0, 0, 0, 40)
			elements.Size = UDim2.new(1, 0, 0, 0)
			elements.AutomaticSize = Enum.AutomaticSize.Y
			elements.Parent = section

			local elementsList = Instance.new("UIListLayout")
			elementsList.SortOrder = Enum.SortOrder.LayoutOrder
			elementsList.Padding = UDim.new(0, 8)
			elementsList.Parent = elements

			local elementsPadding = Instance.new("UIPadding")
			elementsPadding.PaddingTop = UDim.new(0, 8)
			elementsPadding.PaddingLeft = UDim.new(0, 15)
			elementsPadding.PaddingRight = UDim.new(0, 15)
			elementsPadding.PaddingBottom = UDim.new(0, 15)
			elementsPadding.Parent = elements

			-- Button (NO STROKE)
			function Section:AddButton(btnConfig)
				btnConfig = btnConfig or {}
				btnConfig.Name = btnConfig.Name or "Button"
				btnConfig.Callback = btnConfig.Callback or function() end

				local btn = Instance.new("TextButton")
				btn.BackgroundColor3 = Theme.Surface
				btn.BorderSizePixel = 0
				btn.Size = UDim2.new(1, 0, 0, 35)
				btn.Font = Enum.Font.GothamMedium
				btn.Text = btnConfig.Name
				btn.TextColor3 = Theme.Text
				btn.TextSize = 13
				btn.Parent = elements

				AddCorner(btn, 4)

				btn.MouseEnter:Connect(function()
					Tween(btn, {BackgroundColor3 = Theme.Success, TextColor3 = Color3.fromRGB(255, 255, 255)}, 0.15)
				end)

				btn.MouseLeave:Connect(function()
					Tween(btn, {BackgroundColor3 = Theme.Surface, TextColor3 = Theme.Text}, 0.15)
				end)

				btn.MouseButton1Click:Connect(function()
					Tween(btn, {Size = UDim2.new(1, 0, 0, 32)}, 0.08)
					wait(0.08)
					Tween(btn, {Size = UDim2.new(1, 0, 0, 35)}, 0.08)
					task.spawn(function()
						pcall(btnConfig.Callback)
					end)
				end)
			end

			-- Toggle (FULL FRAME CLICKABLE)
			function Section:AddToggle(toggleConfig)
				toggleConfig = toggleConfig or {}
				toggleConfig.Name = toggleConfig.Name or "Toggle"
				toggleConfig.Default = toggleConfig.Default or false
				toggleConfig.Flag = toggleConfig.Flag or nil
				toggleConfig.Callback = toggleConfig.Callback or function() end

				local toggled = toggleConfig.Default

				local toggleFrame = Instance.new("TextButton")
				toggleFrame.BackgroundColor3 = Theme.Surface
				toggleFrame.BorderSizePixel = 0
				toggleFrame.Size = UDim2.new(1, 0, 0, 35)
				toggleFrame.Text = ""
				toggleFrame.Parent = elements

				AddCorner(toggleFrame, 4)
				AddStroke(toggleFrame, Theme.Border, 1, 0)

				local label = Instance.new("TextLabel")
				label.BackgroundTransparency = 1
				label.Font = Enum.Font.GothamMedium
				label.Text = toggleConfig.Name
				label.TextColor3 = Theme.Text
				label.TextSize = 13
				label.Position = UDim2.new(0, 12, 0, 0)
				label.Size = UDim2.new(1, -60, 1, 0)
				label.TextXAlignment = Enum.TextXAlignment.Left
				label.Parent = toggleFrame

				local toggle = Instance.new("Frame")
				toggle.AnchorPoint = Vector2.new(1, 0.5)
				toggle.BackgroundColor3 = toggled and Theme.Success or Theme.Card
				toggle.BorderSizePixel = 0
				toggle.Position = UDim2.new(1, -12, 0.5, 0)
				toggle.Size = UDim2.new(0, 40, 0, 20)
				toggle.Parent = toggleFrame

				AddCorner(toggle, 10)

				local indicator = Instance.new("Frame")
				indicator.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
				indicator.BorderSizePixel = 0
				indicator.Position = toggled and UDim2.new(1, -18, 0.5, 0) or UDim2.new(0, 2, 0.5, 0)
				indicator.AnchorPoint = Vector2.new(0, 0.5)
				indicator.Size = UDim2.new(0, 16, 0, 16)
				indicator.Parent = toggle

				AddCorner(indicator, 8)

				local function updateToggle(state)
					toggled = state
					if toggleConfig.Flag then
						OpenCore.Flags[toggleConfig.Flag] = toggled
					end

					Tween(toggle, {BackgroundColor3 = toggled and Theme.Success or Theme.Card}, 0.2)
					Tween(indicator, {Position = toggled and UDim2.new(1, -18, 0.5, 0) or UDim2.new(0, 2, 0.5, 0)}, 0.2)

					task.spawn(function()
						pcall(toggleConfig.Callback, toggled)
					end)
				end

				toggleFrame.MouseButton1Click:Connect(function()
					updateToggle(not toggled)
				end)

				if toggleConfig.Default then
					updateToggle(true)
				end

				return {
					Set = function(self, value)
						updateToggle(value)
					end
				}
			end

			-- Slider (FULL FRAME DRAGGABLE)
			function Section:AddSlider(sliderConfig)
				sliderConfig = sliderConfig or {}
				sliderConfig.Name = sliderConfig.Name or "Slider"
				sliderConfig.Min = sliderConfig.Min or 0
				sliderConfig.Max = sliderConfig.Max or 100
				sliderConfig.Default = sliderConfig.Default or 50
				sliderConfig.Increment = sliderConfig.Increment or 1
				sliderConfig.Flag = sliderConfig.Flag or nil
				sliderConfig.Callback = sliderConfig.Callback or function() end

				local value = sliderConfig.Default

				local sliderFrame = Instance.new("Frame")
				sliderFrame.BackgroundColor3 = Theme.Surface
				sliderFrame.BorderSizePixel = 0
				sliderFrame.Size = UDim2.new(1, 0, 0, 50)
				sliderFrame.Parent = elements

				AddCorner(sliderFrame, 4)
				AddStroke(sliderFrame, Theme.Border, 1, 0)

				local label = Instance.new("TextLabel")
				label.BackgroundTransparency = 1
				label.Font = Enum.Font.GothamMedium
				label.Text = sliderConfig.Name
				label.TextColor3 = Theme.Text
				label.TextSize = 13
				label.Position = UDim2.new(0, 12, 0, 6)
				label.Size = UDim2.new(0.6, 0, 0, 18)
				label.TextXAlignment = Enum.TextXAlignment.Left
				label.Parent = sliderFrame
				label.ZIndex = 2

				local valueBox = Instance.new("TextBox")
				valueBox.BackgroundTransparency = 1
				valueBox.Font = Enum.Font.GothamBold
				valueBox.Text = tostring(value)
				valueBox.TextColor3 = Theme.SubText
				valueBox.TextSize = 13
				valueBox.Position = UDim2.new(0.6, 0, 0, 6)
				valueBox.Size = UDim2.new(0.4, -12, 0, 18)
				valueBox.TextXAlignment = Enum.TextXAlignment.Right
				valueBox.ClearTextOnFocus = false
				valueBox.Parent = sliderFrame

				local sliderBar = Instance.new("TextButton")
				sliderBar.BackgroundColor3 = Theme.Card
				sliderBar.BorderSizePixel = 0
				sliderBar.Position = UDim2.new(0, 0, 0, 0)
				sliderBar.Size = UDim2.new(1, 0, 1, 0)
				sliderBar.Text = ""
				sliderBar.ZIndex = 1
				sliderBar.Parent = sliderFrame

				AddCorner(sliderBar, 4)

				local sliderBarVisual = Instance.new("Frame")
				sliderBarVisual.BackgroundColor3 = Theme.Card
				sliderBarVisual.BorderSizePixel = 0
				sliderBarVisual.Position = UDim2.new(0, 12, 1, -16)
				sliderBarVisual.Size = UDim2.new(1, -24, 0, 4)
				sliderBarVisual.ZIndex = 2
				sliderBarVisual.Parent = sliderFrame

				AddCorner(sliderBarVisual, 2)

				local sliderFill = Instance.new("Frame")
				sliderFill.BackgroundColor3 = Theme.SliderFill
				sliderFill.BorderSizePixel = 0
				sliderFill.Size = UDim2.new((value - sliderConfig.Min) / (sliderConfig.Max - sliderConfig.Min), 0, 1, 0)
				sliderFill.ZIndex = 3
				sliderFill.Parent = sliderBarVisual

				AddCorner(sliderFill, 2)

				local dragging = false

				local function updateSlider(input)
					local pos = (input.Position.X - sliderBarVisual.AbsolutePosition.X) / sliderBarVisual.AbsoluteSize.X
					pos = math.clamp(pos, 0, 1)

					value = math.floor((sliderConfig.Min + (sliderConfig.Max - sliderConfig.Min) * pos) / sliderConfig.Increment + 0.5) * sliderConfig.Increment
					value = math.clamp(value, sliderConfig.Min, sliderConfig.Max)

					if sliderConfig.Flag then
						OpenCore.Flags[sliderConfig.Flag] = value
					end

					valueBox.Text = tostring(value)
					Tween(sliderFill, {Size = UDim2.new((value - sliderConfig.Min) / (sliderConfig.Max - sliderConfig.Min), 0, 1, 0)}, 0.05)

					task.spawn(function()
						pcall(sliderConfig.Callback, value)
					end)
				end

				sliderBar.InputBegan:Connect(function(input)
					if input.UserInputType == Enum.UserInputType.MouseButton1 then
						dragging = true
						updateSlider(input)
					end
				end)

				sliderBar.InputEnded:Connect(function(input)
					if input.UserInputType == Enum.UserInputType.MouseButton1 then
						dragging = false
					end
				end)

				UserInputService.InputChanged:Connect(function(input)
					if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
						updateSlider(input)
					end
				end)

				valueBox.FocusLost:Connect(function()
					local newValue = tonumber(valueBox.Text)
					if newValue then
						value = math.clamp(newValue, sliderConfig.Min, sliderConfig.Max)
						valueBox.Text = tostring(value)
						sliderFill.Size = UDim2.new((value - sliderConfig.Min) / (sliderConfig.Max - sliderConfig.Min), 0, 1, 0)
						if sliderConfig.Flag then
							OpenCore.Flags[sliderConfig.Flag] = value
						end
						task.spawn(function()
							pcall(sliderConfig.Callback, value)
						end)
					else
						valueBox.Text = tostring(value)
					end
				end)

				return {
					Set = function(self, val)
						value = math.clamp(val, sliderConfig.Min, sliderConfig.Max)
						valueBox.Text = tostring(value)
						sliderFill.Size = UDim2.new((value - sliderConfig.Min) / (sliderConfig.Max - sliderConfig.Min), 0, 1, 0)
						if sliderConfig.Flag then
							OpenCore.Flags[sliderConfig.Flag] = value
						end
					end
				}
			end

			-- Dropdown
			function Section:AddDropdown(dropConfig)
				dropConfig = dropConfig or {}
				dropConfig.Name = dropConfig.Name or "Dropdown"
				dropConfig.Options = dropConfig.Options or {}
				dropConfig.Default = dropConfig.Default or dropConfig.Options[1] or "None"
				dropConfig.Flag = dropConfig.Flag or nil
				dropConfig.Callback = dropConfig.Callback or function() end

				local selected = dropConfig.Default
				local opened = false

				local dropFrame = Instance.new("Frame")
				dropFrame.BackgroundColor3 = Theme.Surface
				dropFrame.BorderSizePixel = 0
				dropFrame.Size = UDim2.new(1, 0, 0, 35)
				dropFrame.ClipsDescendants = true
				dropFrame.Parent = elements

				AddCorner(dropFrame, 4)
				AddStroke(dropFrame, Theme.Border, 1, 0)

				local header = Instance.new("TextButton")
				header.BackgroundTransparency = 1
				header.Size = UDim2.new(1, 0, 0, 35)
				header.Text = ""
				header.Parent = dropFrame

				local label = Instance.new("TextLabel")
				label.BackgroundTransparency = 1
				label.Font = Enum.Font.GothamMedium
				label.Text = dropConfig.Name
				label.TextColor3 = Theme.Text
				label.TextSize = 13
				label.Position = UDim2.new(0, 12, 0, 0)
				label.Size = UDim2.new(0.4, 0, 1, 0)
				label.TextXAlignment = Enum.TextXAlignment.Left
				label.Parent = header

				local valueLabel = Instance.new("TextLabel")
				valueLabel.BackgroundTransparency = 1
				valueLabel.Font = Enum.Font.Gotham
				valueLabel.Text = selected
				valueLabel.TextColor3 = Theme.SubText
				valueLabel.TextSize = 12
				valueLabel.Position = UDim2.new(0.4, 0, 0, 0)
				valueLabel.Size = UDim2.new(0.6, -35, 1, 0)
				valueLabel.TextXAlignment = Enum.TextXAlignment.Right
				valueLabel.Parent = header

				local arrow = Instance.new("ImageLabel")
				arrow.BackgroundTransparency = 1
				arrow.Image = Icons.ChevronDown
				arrow.ImageColor3 = Theme.SubText
				arrow.AnchorPoint = Vector2.new(1, 0.5)
				arrow.Position = UDim2.new(1, -12, 0.5, 0)
				arrow.Size = UDim2.new(0, 14, 0, 14)
				arrow.Parent = header

				local optionsContainer = Instance.new("Frame")
				optionsContainer.BackgroundColor3 = Theme.Card
				optionsContainer.BorderSizePixel = 0
				optionsContainer.Position = UDim2.new(0, 1, 0, 36)
				optionsContainer.Size = UDim2.new(1, -2, 0, 0)
				optionsContainer.Parent = dropFrame

				local optionsList = Instance.new("UIListLayout")
				optionsList.SortOrder = Enum.SortOrder.LayoutOrder
				optionsList.Padding = UDim.new(0, 0)
				optionsList.Parent = optionsContainer

				local function createOption(optionName)
					local option = Instance.new("TextButton")
					option.BackgroundColor3 = Theme.Card
					option.BorderSizePixel = 0
					option.Size = UDim2.new(1, 0, 0, 30)
					option.Font = Enum.Font.Gotham
					option.Text = "  " .. optionName
					option.TextColor3 = Theme.SubText
					option.TextSize = 12
					option.TextXAlignment = Enum.TextXAlignment.Left
					option.Parent = optionsContainer

					option.MouseEnter:Connect(function()
						Tween(option, {BackgroundColor3 = Theme.Success, TextColor3 = Color3.fromRGB(255, 255, 255)}, 0.1)
					end)

					option.MouseLeave:Connect(function()
						Tween(option, {BackgroundColor3 = Theme.Card, TextColor3 = Theme.SubText}, 0.1)
					end)

					option.MouseButton1Click:Connect(function()
						selected = optionName
						valueLabel.Text = selected
						if dropConfig.Flag then
							OpenCore.Flags[dropConfig.Flag] = selected
						end

						opened = false
						Tween(dropFrame, {Size = UDim2.new(1, 0, 0, 35)}, 0.2)
						Tween(arrow, {Rotation = 0}, 0.2)

						task.spawn(function()
							pcall(dropConfig.Callback, selected)
						end)
					end)
				end

				for _, option in ipairs(dropConfig.Options) do
					createOption(option)
				end

				header.MouseButton1Click:Connect(function()
					opened = not opened
					local targetSize = opened and UDim2.new(1, 0, 0, 36 + (#dropConfig.Options * 30)) or UDim2.new(1, 0, 0, 35)

					Tween(dropFrame, {Size = targetSize}, 0.2)
					Tween(arrow, {Rotation = opened and 180 or 0}, 0.2)
				end)

				return {
					Set = function(self, value)
						selected = value
						valueLabel.Text = selected
						if dropConfig.Flag then
							OpenCore.Flags[dropConfig.Flag] = selected
						end
					end,
					Refresh = function(self, options)
						for _, child in ipairs(optionsContainer:GetChildren()) do
							if child:IsA("TextButton") then
								child:Destroy()
							end
						end
						dropConfig.Options = options
						for _, option in ipairs(options) do
							createOption(option)
						end
					end
				}
			end

			-- Color Picker with RGB sliders
			function Section:AddColorPicker(colorConfig)
				colorConfig = colorConfig or {}
				colorConfig.Name = colorConfig.Name or "Color Picker"
				colorConfig.Default = colorConfig.Default or Color3.fromRGB(255, 255, 255)
				colorConfig.Flag = colorConfig.Flag or nil
				colorConfig.Callback = colorConfig.Callback or function() end

				local selectedColor = colorConfig.Default
				local r, g, b = math.floor(selectedColor.R * 255), math.floor(selectedColor.G * 255), math.floor(selectedColor.B * 255)

				local colorFrame = Instance.new("Frame")
				colorFrame.BackgroundColor3 = Theme.Surface
				colorFrame.BorderSizePixel = 0
				colorFrame.Size = UDim2.new(1, 0, 0, 130)
				colorFrame.Parent = elements

				AddCorner(colorFrame, 4)
				AddStroke(colorFrame, Theme.Border, 1, 0)

				local label = Instance.new("TextLabel")
				label.BackgroundTransparency = 1
				label.Font = Enum.Font.GothamMedium
				label.Text = colorConfig.Name
				label.TextColor3 = Theme.Text
				label.TextSize = 13
				label.Position = UDim2.new(0, 12, 0, 8)
				label.Size = UDim2.new(1, -60, 0, 20)
				label.TextXAlignment = Enum.TextXAlignment.Left
				label.Parent = colorFrame

				local colorPreview = Instance.new("Frame")
				colorPreview.AnchorPoint = Vector2.new(1, 0)
				colorPreview.BackgroundColor3 = selectedColor
				colorPreview.BorderSizePixel = 0
				colorPreview.Position = UDim2.new(1, -12, 0, 8)
				colorPreview.Size = UDim2.new(0, 35, 0, 20)
				colorPreview.Parent = colorFrame

				AddCorner(colorPreview, 4)
				AddStroke(colorPreview, Theme.Border, 1, 0)

				local function createSlider(name, defaultVal, yPos)
					local sliderLabel = Instance.new("TextLabel")
					sliderLabel.BackgroundTransparency = 1
					sliderLabel.Font = Enum.Font.Gotham
					sliderLabel.Text = name .. ":"
					sliderLabel.TextColor3 = Theme.SubText
					sliderLabel.TextSize = 11
					sliderLabel.Position = UDim2.new(0, 12, 0, yPos)
					sliderLabel.Size = UDim2.new(0, 15, 0, 18)
					sliderLabel.TextXAlignment = Enum.TextXAlignment.Left
					sliderLabel.Parent = colorFrame

					local sliderValue = Instance.new("TextBox")
					sliderValue.BackgroundTransparency = 1
					sliderValue.Font = Enum.Font.GothamBold
					sliderValue.Text = tostring(defaultVal)
					sliderValue.TextColor3 = Theme.SubText
					sliderValue.TextSize = 11
					sliderValue.Position = UDim2.new(1, -40, 0, yPos)
					sliderValue.Size = UDim2.new(0, 28, 0, 18)
					sliderValue.TextXAlignment = Enum.TextXAlignment.Right
					sliderValue.ClearTextOnFocus = false
					sliderValue.Parent = colorFrame

					local sliderBar = Instance.new("TextButton")
					sliderBar.BackgroundColor3 = Theme.Card
					sliderBar.BorderSizePixel = 0
					sliderBar.Position = UDim2.new(0, 35, 0, yPos + 4)
					sliderBar.Size = UDim2.new(1, -85, 0, 10)
					sliderBar.Text = ""
					sliderBar.Parent = colorFrame

					AddCorner(sliderBar, 5)

					local sliderFill = Instance.new("Frame")
					sliderFill.BackgroundColor3 = Theme.SliderFill
					sliderFill.BorderSizePixel = 0
					sliderFill.Size = UDim2.new(defaultVal / 255, 0, 1, 0)
					sliderFill.Parent = sliderBar

					AddCorner(sliderFill, 5)

					return sliderBar, sliderFill, sliderValue
				end

				local rBar, rFill, rValue = createSlider("R", r, 35)
				local gBar, gFill, gValue = createSlider("G", g, 60)
				local bBar, bFill, bValue = createSlider("B", b, 85)

				local function updateColor()
					selectedColor = Color3.fromRGB(r, g, b)
					colorPreview.BackgroundColor3 = selectedColor
					if colorConfig.Flag then
						OpenCore.Flags[colorConfig.Flag] = selectedColor
					end
					task.spawn(function()
						pcall(colorConfig.Callback, selectedColor)
					end)
				end

				local function createSliderLogic(bar, fill, valueBox, colorChannel)
					local dragging = false

					local function update(input)
						local pos = math.clamp((input.Position.X - bar.AbsolutePosition.X) / bar.AbsoluteSize.X, 0, 1)
						local val = math.floor(pos * 255)

						if colorChannel == "r" then r = val
						elseif colorChannel == "g" then g = val
						elseif colorChannel == "b" then b = val end

						valueBox.Text = tostring(val)
						Tween(fill, {Size = UDim2.new(pos, 0, 1, 0)}, 0.05)
						updateColor()
					end

					bar.InputBegan:Connect(function(input)
						if input.UserInputType == Enum.UserInputType.MouseButton1 then
							dragging = true
							update(input)
						end
					end)

					bar.InputEnded:Connect(function(input)
						if input.UserInputType == Enum.UserInputType.MouseButton1 then
							dragging = false
						end
					end)

					UserInputService.InputChanged:Connect(function(input)
						if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
							update(input)
						end
					end)

					valueBox.FocusLost:Connect(function()
						local val = tonumber(valueBox.Text)
						if val then
							val = math.clamp(val, 0, 255)
							if colorChannel == "r" then r = val
							elseif colorChannel == "g" then g = val
							elseif colorChannel == "b" then b = val end
							valueBox.Text = tostring(val)
							fill.Size = UDim2.new(val / 255, 0, 1, 0)
							updateColor()
						else
							if colorChannel == "r" then valueBox.Text = tostring(r)
							elseif colorChannel == "g" then valueBox.Text = tostring(g)
							elseif colorChannel == "b" then valueBox.Text = tostring(b) end
						end
					end)
				end

				createSliderLogic(rBar, rFill, rValue, "r")
				createSliderLogic(gBar, gFill, gValue, "g")
				createSliderLogic(bBar, bFill, bValue, "b")

				return {
					Set = function(self, color)
						selectedColor = color
						r, g, b = math.floor(color.R * 255), math.floor(color.G * 255), math.floor(color.B * 255)
						rValue.Text = tostring(r)
						gValue.Text = tostring(g)
						bValue.Text = tostring(b)
						rFill.Size = UDim2.new(r / 255, 0, 1, 0)
						gFill.Size = UDim2.new(g / 255, 0, 1, 0)
						bFill.Size = UDim2.new(b / 255, 0, 1, 0)
						colorPreview.BackgroundColor3 = selectedColor
						if colorConfig.Flag then
							OpenCore.Flags[colorConfig.Flag] = selectedColor
						end
					end
				}
			end

			-- Input
			function Section:AddInput(inputConfig)
				inputConfig = inputConfig or {}
				inputConfig.Name = inputConfig.Name or "Input"
				inputConfig.Default = inputConfig.Default or ""
				inputConfig.Placeholder = inputConfig.Placeholder or "Enter text..."
				inputConfig.Flag = inputConfig.Flag or nil
				inputConfig.Callback = inputConfig.Callback or function() end

				local inputFrame = Instance.new("Frame")
				inputFrame.BackgroundColor3 = Theme.Surface
				inputFrame.BorderSizePixel = 0
				inputFrame.Size = UDim2.new(1, 0, 0, 50)
				inputFrame.Parent = elements

				AddCorner(inputFrame, 4)
				AddStroke(inputFrame, Theme.Border, 1, 0)

				local label = Instance.new("TextLabel")
				label.BackgroundTransparency = 1
				label.Font = Enum.Font.GothamMedium
				label.Text = inputConfig.Name
				label.TextColor3 = Theme.Text
				label.TextSize = 13
				label.Position = UDim2.new(0, 12, 0, 6)
				label.Size = UDim2.new(1, -24, 0, 18)
				label.TextXAlignment = Enum.TextXAlignment.Left
				label.Parent = inputFrame

				local textBox = Instance.new("TextBox")
				textBox.BackgroundColor3 = Theme.Card
				textBox.BorderSizePixel = 0
				textBox.Position = UDim2.new(0, 12, 0, 28)
				textBox.Size = UDim2.new(1, -24, 0, 18)
				textBox.Font = Enum.Font.Gotham
				textBox.PlaceholderText = inputConfig.Placeholder
				textBox.PlaceholderColor3 = Theme.Muted
				textBox.Text = inputConfig.Default
				textBox.TextColor3 = Theme.Text
				textBox.TextSize = 12
				textBox.TextXAlignment = Enum.TextXAlignment.Left
				textBox.ClearTextOnFocus = false
				textBox.Parent = inputFrame

				AddCorner(textBox, 3)

				local textPadding = Instance.new("UIPadding")
				textPadding.PaddingLeft = UDim.new(0, 8)
				textPadding.PaddingRight = UDim.new(0, 8)
				textPadding.Parent = textBox

				textBox.FocusLost:Connect(function()
					if inputConfig.Flag then
						OpenCore.Flags[inputConfig.Flag] = textBox.Text
					end
					task.spawn(function()
						pcall(inputConfig.Callback, textBox.Text)
					end)
				end)

				return {
					Set = function(self, value)
						textBox.Text = value
						if inputConfig.Flag then
							OpenCore.Flags[inputConfig.Flag] = value
						end
					end
				}
			end

			-- Label (UPDATABLE)
			function Section:AddLabel(labelConfig)
				labelConfig = labelConfig or {}
				labelConfig.Text = labelConfig.Text or "Label"

				local labelFrame = Instance.new("Frame")
				labelFrame.BackgroundTransparency = 1
				labelFrame.Size = UDim2.new(1, 0, 0, 20)
				labelFrame.Parent = elements

				local label = Instance.new("TextLabel")
				label.BackgroundTransparency = 1
				label.Font = Enum.Font.Gotham
				label.Text = labelConfig.Text
				label.TextColor3 = Theme.SubText
				label.TextSize = 12
				label.Size = UDim2.new(1, 0, 1, 0)
				label.TextXAlignment = Enum.TextXAlignment.Left
				label.TextWrapped = true
				label.Parent = labelFrame

				return {
					Set = function(self, text)
						label.Text = text
					end,
					SetColor = function(self, color)
						label.TextColor3 = color
					end
				}
			end

			return Section
		end

		return Tab
	end

	return Window
end

return OpenCore
